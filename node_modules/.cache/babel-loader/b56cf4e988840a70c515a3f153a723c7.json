{"ast":null,"code":"var _jsxFileName = \"/Users/h4nuko0n/ipfs-example/eth-ipfs/src/App.js\";\nimport { Table, Grid, Button, Form } from 'react-bootstrap';\nimport React, { Component } from 'react';\nimport { FilePond } from 'react-filepond';\nimport 'filepond/dist/filepond.min.css'; //import logo from './logo.svg';\n\nimport './App.css';\nimport storehash from './storehash'; //-------------web3-----------------\n\nimport Web3 from 'web3'; //overrides metamask v0.2 for our v 1.0\n\nconst web3 = new Web3(window.web3.currentProvider); //-------------IPFS---------------\n//infura 사용\n\nconst IPFS = require('ipfs-api');\n\nconst ipfs = new IPFS({\n  host: 'ipfs.infura.io',\n  port: 5001,\n  protocol: 'https'\n}); // 로컬 데몬으로 돌릴때\n// const ipfsApi = require('ipfs-api');\n// const ipfs = new ipfsApi('localhost', '5001', {protocol: 'http'});\n//----------------------------------\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      ipfsHash: null,\n      buffer: '',\n      transactionHash: '',\n      txReceipt: '',\n      filename: ''\n    };\n\n    this.captureFile = event => {\n      event.stopPropagation();\n      event.preventDefault();\n      const file = event.target.files[0]; // this.setState.filename\n\n      let reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => this.convertToBuffer(reader);\n    };\n\n    this.convertToBuffer = async reader => {\n      //file is converted to a buffer to prepare for uploading to IPFS\n      const buffer = await Buffer.from(reader.result); //set this buffer -using es6 syntax\n\n      this.setState({\n        buffer\n      });\n    };\n\n    this.onClick = async () => {\n      try {\n        this.setState({\n          blockNumber: \"now panding..\"\n        });\n        this.setState({\n          gasUsed: \"now panding..\"\n        }); //get reception\n\n        await web3.eth.getTransactionReceipt(this.state.transactionHash, (err, txReceipt) => {\n          console.log(err, txReceipt);\n          this.setState({\n            txReceipt\n          });\n        }); //await for getTransactionReceipt\n\n        await this.setState({\n          blockNumber: this.state.txReceipt.blockNumber\n        });\n        await this.setState({\n          gasUsed: this.state.txReceipt.gasUsed\n        });\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    this.onSubmit = async event => {\n      event.preventDefault(); //user wallet (ex:Metamask)\n\n      const accounts = await web3.eth.getAccounts();\n      console.log('Sending from Metamask account: ' + accounts[0]); //get contract account \n\n      const ethAddress = await storehash.options.address;\n      this.setState({\n        ethAddress\n      }); //set hash\n\n      await ipfs.add(this.state.buffer, (err, ipfsHash) => {\n        console.log(err, ipfsHash); //setState by setting ipfsHash to ipfsHash[0].hash \n\n        this.setState({\n          ipfsHash: ipfsHash[0].hash\n        }); //send IPFS hash to ETH\n\n        storehash.methods.sendHash(this.state.ipfsHash).send({\n          from: accounts[0]\n        }, (error, transactionHash) => {\n          console.log(transactionHash);\n          this.setState({\n            transactionHash\n          });\n        });\n      });\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, React.createElement(\"header\", {\n      className: \"App-header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }, \" ETH + IPFS upload simple example dapp (ETHCON KOREA 2019)\")), React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }), React.createElement(Grid, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, \"upload file to IPFS\"), React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, React.createElement(FilePond, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    })), React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }), React.createElement(Button, {\n      class: \"send\",\n      onClick: this.onClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, \" refresh \"), React.createElement(Table, {\n      bordered: true,\n      responsive: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, \"Transaction Data\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, \"Values\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, \"IPFS Hash\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, this.state.ipfsHash)), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, \"ETH CONTRACT ADDR\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, this.state.ethAddress)), React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, \"Tx Hash\"), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, this.state.transactionHash))))));\n  } //render\n\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/h4nuko0n/ipfs-example/eth-ipfs/src/App.js"],"names":["Table","Grid","Button","Form","React","Component","FilePond","storehash","Web3","web3","window","currentProvider","IPFS","require","ipfs","host","port","protocol","App","state","ipfsHash","buffer","transactionHash","txReceipt","filename","captureFile","event","stopPropagation","preventDefault","file","target","files","reader","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","Buffer","from","result","setState","onClick","blockNumber","gasUsed","eth","getTransactionReceipt","err","console","log","error","onSubmit","accounts","getAccounts","ethAddress","options","address","add","hash","methods","sendHash","send","render"],"mappings":"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","sourcesContent":["import { Table, Grid, Button, Form } from 'react-bootstrap';\nimport React, { Component } from 'react';\n\nimport { FilePond } from 'react-filepond';\nimport 'filepond/dist/filepond.min.css';\n//import logo from './logo.svg';\nimport './App.css';\nimport storehash from './storehash';\n//-------------web3-----------------\nimport Web3 from 'web3';\n//overrides metamask v0.2 for our v 1.0\nconst web3 = new Web3(window.web3.currentProvider);\n//-------------IPFS---------------\n//infura 사용\nconst IPFS = require('ipfs-api');\nconst ipfs = new IPFS({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' });\n// 로컬 데몬으로 돌릴때\n// const ipfsApi = require('ipfs-api');\n// const ipfs = new ipfsApi('localhost', '5001', {protocol: 'http'});\n//----------------------------------\n\nclass App extends Component {\n\n  state = {\n    ipfsHash: null,\n    buffer: '',\n    transactionHash: '',\n    txReceipt: '',\n    filename: ''\n  };\n  captureFile = (event) => {\n    event.stopPropagation()\n    event.preventDefault()\n    const file = event.target.files[0]\n    // this.setState.filename\n    let reader = new window.FileReader()\n    reader.readAsArrayBuffer(file)\n    reader.onloadend = () => this.convertToBuffer(reader)\n\n  };\n\n  convertToBuffer = async (reader) => {\n    //file is converted to a buffer to prepare for uploading to IPFS\n    const buffer = await Buffer.from(reader.result);\n    //set this buffer -using es6 syntax\n    this.setState({ buffer });\n  };\n\n  onClick = async () => {\n\n    try {\n      this.setState({ blockNumber: \"now panding..\" });\n      this.setState({ gasUsed: \"now panding..\" });\n\n      //get reception\n      await web3.eth.getTransactionReceipt(this.state.transactionHash, (err, txReceipt) => {\n        console.log(err, txReceipt);\n        this.setState({ txReceipt });\n      }); //await for getTransactionReceipt\n\n      await this.setState({ blockNumber: this.state.txReceipt.blockNumber });\n      await this.setState({ gasUsed: this.state.txReceipt.gasUsed });\n    }\n    catch (error) {\n      console.log(error);\n    }\n  }\n\n  onSubmit = async (event) => {\n    event.preventDefault();\n\n    //user wallet (ex:Metamask)\n    const accounts = await web3.eth.getAccounts();\n\n    console.log('Sending from Metamask account: ' + accounts[0]);\n\n    //get contract account \n    const ethAddress = await storehash.options.address;\n    this.setState({ ethAddress });\n\n    //set hash\n    await ipfs.add(this.state.buffer, (err, ipfsHash) => {\n      console.log(err, ipfsHash);\n      //setState by setting ipfsHash to ipfsHash[0].hash \n      this.setState({ ipfsHash: ipfsHash[0].hash });\n      //send IPFS hash to ETH\n      storehash.methods.sendHash(this.state.ipfsHash).send({\n        from: accounts[0]\n      }, (error, transactionHash) => {\n        console.log(transactionHash);\n        this.setState({ transactionHash });\n      });\n    })\n  };\n\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <h1> ETH + IPFS upload simple example dapp (ETHCON KOREA 2019)</h1>\n        </header>\n\n        <hr />\n\n        <Grid>\n          <h3>upload file to IPFS</h3>\n          <Form onSubmit={this.onSubmit}>\n            <FilePond />\n          </Form>\n          <hr />\n          <Button class=\"send\" onClick={this.onClick}> refresh </Button>\n\n          <Table bordered responsive>\n            <thead>\n              <tr>\n                <th>Transaction Data</th>\n                <th>Values</th>\n              </tr>\n            </thead>\n\n            <tbody>\n              <tr>\n                {/* <td>File Name</td>\n                <td>{this.state.event.target.files}</td> */}\n                <td>IPFS Hash</td>\n                <td>{this.state.ipfsHash}</td>\n              </tr>\n              <tr>\n                <td>ETH CONTRACT ADDR</td>\n                <td>{this.state.ethAddress}</td>\n              </tr>\n\n              <tr>\n                <td>Tx Hash</td>\n                <td>{this.state.transactionHash}</td>\n              </tr>\n            </tbody>\n          </Table>\n        </Grid>\n      </div>\n    );\n  } //render\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}