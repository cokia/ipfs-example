{"ast":null,"code":"'use strict';\n\nconst promisify = require('promisify-es6');\n\nconst dagPB = require('ipld-dag-pb');\n\nconst DAGNode = dagPB.DAGNode;\n\nconst Unixfs = require('ipfs-unixfs');\n\nmodule.exports = send => {\n  return promisify((template, callback) => {\n    if (typeof template === 'function') {\n      callback = template;\n      template = undefined;\n    }\n\n    send({\n      path: 'object/new',\n      args: template\n    }, (err, result) => {\n      if (err) {\n        return callback(err);\n      }\n\n      let data;\n\n      if (template) {\n        if (template !== 'unixfs-dir') {\n          return callback(new Error('unkown template: ' + template));\n        }\n\n        data = new Unixfs('directory').marshal();\n      } else {\n        data = Buffer.alloc(0);\n      }\n\n      DAGNode.create(data, (err, node) => {\n        if (err) {\n          return callback(err);\n        }\n\n        if (node.toJSON().multihash !== result.Hash) {\n          return callback(new Error('multihashes do not match'));\n        }\n\n        callback(null, node);\n      });\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"script"}