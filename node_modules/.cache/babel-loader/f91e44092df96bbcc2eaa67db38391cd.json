{"ast":null,"code":"'use strict';\n\nconst pump = require('pump');\n\nconst tar = require('tar-stream');\n\nconst ReadableStream = require('readable-stream').Readable;\n\nclass ObjectsStreams extends ReadableStream {\n  constructor(options) {\n    const opts = Object.assign(options || {}, {\n      objectMode: true\n    });\n    super(opts);\n  }\n\n  _read() {}\n\n}\n/*\n  Transform a tar stream into a stream of objects:\n\n  Output format:\n  { path: 'string', content: Stream<Readable> }\n*/\n\n\nconst TarStreamToObjects = (inputStream, callback) => {\n  let outputStream = new ObjectsStreams();\n  let extractStream = tar.extract();\n  extractStream.on('entry', (header, stream, next) => {\n    stream.on('end', next);\n\n    if (header.type !== 'directory') {\n      outputStream.push({\n        path: header.name,\n        content: stream\n      });\n    } else {\n      outputStream.push({\n        path: header.name\n      });\n      stream.resume();\n    }\n  }).on('finish', () => outputStream.push(null));\n  pump(inputStream, extractStream);\n  callback(null, outputStream);\n};\n\nmodule.exports = TarStreamToObjects;","map":null,"metadata":{},"sourceType":"script"}