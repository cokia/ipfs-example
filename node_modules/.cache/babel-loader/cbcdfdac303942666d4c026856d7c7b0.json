{"ast":null,"code":"'use strict';\n\nconst secp256k1 = require('secp256k1');\n\nconst multihashing = require('multihashing-async');\n\nconst setImmediate = require('async/setImmediate');\n\nconst HASH_ALGORITHM = 'sha2-256';\n\nmodule.exports = randomBytes => {\n  const privateKeyLength = 32;\n\n  function generateKey(callback) {\n    const done = (err, res) => setImmediate(() => callback(err, res));\n\n    let privateKey;\n\n    do {\n      privateKey = randomBytes(32);\n    } while (!secp256k1.privateKeyVerify(privateKey));\n\n    done(null, privateKey);\n  }\n\n  function hashAndSign(key, msg, callback) {\n    const done = (err, res) => setImmediate(() => callback(err, res));\n\n    multihashing.digest(msg, HASH_ALGORITHM, (err, digest) => {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        const sig = secp256k1.sign(digest, key);\n        const sigDER = secp256k1.signatureExport(sig.signature);\n        return done(null, sigDER);\n      } catch (err) {\n        done(err);\n      }\n    });\n  }\n\n  function hashAndVerify(key, sig, msg, callback) {\n    const done = (err, res) => setImmediate(() => callback(err, res));\n\n    multihashing.digest(msg, HASH_ALGORITHM, (err, digest) => {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        sig = secp256k1.signatureImport(sig);\n        const valid = secp256k1.verify(digest, sig, key);\n        return done(null, valid);\n      } catch (err) {\n        done(err);\n      }\n    });\n  }\n\n  function compressPublicKey(key) {\n    if (!secp256k1.publicKeyVerify(key)) {\n      throw new Error('Invalid public key');\n    }\n\n    return secp256k1.publicKeyConvert(key, true);\n  }\n\n  function decompressPublicKey(key) {\n    return secp256k1.publicKeyConvert(key, false);\n  }\n\n  function validatePrivateKey(key) {\n    if (!secp256k1.privateKeyVerify(key)) {\n      throw new Error('Invalid private key');\n    }\n  }\n\n  function validatePublicKey(key) {\n    if (!secp256k1.publicKeyVerify(key)) {\n      throw new Error('Invalid public key');\n    }\n  }\n\n  function computePublicKey(privateKey) {\n    validatePrivateKey(privateKey);\n    return secp256k1.publicKeyCreate(privateKey);\n  }\n\n  return {\n    generateKey: generateKey,\n    privateKeyLength: privateKeyLength,\n    hashAndSign: hashAndSign,\n    hashAndVerify: hashAndVerify,\n    compressPublicKey: compressPublicKey,\n    decompressPublicKey: decompressPublicKey,\n    validatePrivateKey: validatePrivateKey,\n    validatePublicKey: validatePublicKey,\n    computePublicKey: computePublicKey\n  };\n};","map":null,"metadata":{},"sourceType":"script"}