{"ast":null,"code":"'use strict';\n\nconst asn1 = require('asn1.js');\n\nconst util = require('./../util');\n\nconst toBase64 = util.toBase64;\nconst toBn = util.toBn;\nconst RSAPrivateKey = asn1.define('RSAPrivateKey', function () {\n  this.seq().obj(this.key('version').int(), this.key('modulus').int(), this.key('publicExponent').int(), this.key('privateExponent').int(), this.key('prime1').int(), this.key('prime2').int(), this.key('exponent1').int(), this.key('exponent2').int(), this.key('coefficient').int());\n});\nconst AlgorithmIdentifier = asn1.define('AlgorithmIdentifier', function () {\n  this.seq().obj(this.key('algorithm').objid({\n    '1.2.840.113549.1.1.1': 'rsa'\n  }), this.key('none').optional().null_(), this.key('curve').optional().objid(), this.key('params').optional().seq().obj(this.key('p').int(), this.key('q').int(), this.key('g').int()));\n});\nconst PublicKey = asn1.define('RSAPublicKey', function () {\n  this.seq().obj(this.key('algorithm').use(AlgorithmIdentifier), this.key('subjectPublicKey').bitstr());\n});\nconst RSAPublicKey = asn1.define('RSAPublicKey', function () {\n  this.seq().obj(this.key('modulus').int(), this.key('publicExponent').int());\n}); // Convert a PKCS#1 in ASN1 DER format to a JWK key\n\nexports.pkcs1ToJwk = function (bytes) {\n  const asn1 = RSAPrivateKey.decode(bytes, 'der');\n  return {\n    kty: 'RSA',\n    n: toBase64(asn1.modulus),\n    e: toBase64(asn1.publicExponent),\n    d: toBase64(asn1.privateExponent),\n    p: toBase64(asn1.prime1),\n    q: toBase64(asn1.prime2),\n    dp: toBase64(asn1.exponent1),\n    dq: toBase64(asn1.exponent2),\n    qi: toBase64(asn1.coefficient),\n    alg: 'RS256',\n    kid: '2011-04-29'\n  };\n}; // Convert a JWK key into PKCS#1 in ASN1 DER format\n\n\nexports.jwkToPkcs1 = function (jwk) {\n  return RSAPrivateKey.encode({\n    version: 0,\n    modulus: toBn(jwk.n),\n    publicExponent: toBn(jwk.e),\n    privateExponent: toBn(jwk.d),\n    prime1: toBn(jwk.p),\n    prime2: toBn(jwk.q),\n    exponent1: toBn(jwk.dp),\n    exponent2: toBn(jwk.dq),\n    coefficient: toBn(jwk.qi)\n  }, 'der');\n}; // Convert a PKCIX in ASN1 DER format to a JWK key\n\n\nexports.pkixToJwk = function (bytes) {\n  const ndata = PublicKey.decode(bytes, 'der');\n  const asn1 = RSAPublicKey.decode(ndata.subjectPublicKey.data, 'der');\n  return {\n    kty: 'RSA',\n    n: toBase64(asn1.modulus),\n    e: toBase64(asn1.publicExponent),\n    alg: 'RS256',\n    kid: '2011-04-29'\n  };\n}; // Convert a JWK key to PKCIX in ASN1 DER format\n\n\nexports.jwkToPkix = function (jwk) {\n  return PublicKey.encode({\n    algorithm: {\n      algorithm: 'rsa',\n      none: null\n    },\n    subjectPublicKey: {\n      data: RSAPublicKey.encode({\n        modulus: toBn(jwk.n),\n        publicExponent: toBn(jwk.e)\n      }, 'der')\n    }\n  }, 'der');\n};","map":null,"metadata":{},"sourceType":"script"}