{"ast":null,"code":"'use strict';\n\nconst promisify = require('promisify-es6');\n\nconst Block = require('ipfs-block');\n\nconst CID = require('cids');\n\nconst streamToValue = require('../utils/stream-to-value');\n\nmodule.exports = send => {\n  return promisify((args, opts, callback) => {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    } // TODO this needs to be adjusted with the new go-ipfs http-api\n\n\n    let cid;\n\n    try {\n      if (CID.isCID(args)) {\n        cid = args;\n        args = cid.toBaseEncodedString();\n      } else if (Buffer.isBuffer(args)) {\n        cid = new CID(args);\n        args = cid.toBaseEncodedString();\n      } else if (typeof args === 'string') {\n        cid = new CID(args);\n      } else {\n        return callback(new Error('invalid argument'));\n      }\n    } catch (err) {\n      return callback(err);\n    } // Transform the response from Buffer or a Stream to a Block\n\n\n    const transform = (res, callback) => {\n      if (Buffer.isBuffer(res)) {\n        callback(null, new Block(res, cid)); // For empty blocks, concat-stream can't infer the encoding so we are\n        // passed back an empty array\n      } else if (Array.isArray(res) && res.length === 0) {\n        callback(null, new Block(Buffer.alloc(0), cid));\n      } else {\n        streamToValue(res, (err, data) => {\n          if (err) {\n            return callback(err);\n          } // For empty blocks, concat-stream can't infer the encoding so we are\n          // passed back an empty array\n\n\n          if (!data.length) data = Buffer.alloc(0);\n          callback(null, new Block(data, cid));\n        });\n      }\n    };\n\n    const request = {\n      path: 'block/get',\n      args: args,\n      qs: opts\n    };\n    send.andTransform(request, transform, callback);\n  });\n};","map":null,"metadata":{},"sourceType":"script"}